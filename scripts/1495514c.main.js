var matrix=[],labels=[];d3.text("data/titles502.csv",function(a,b){labels=d3.csv.parseRows(b),d3.text("data/d3matrix502.csv",function(a,b){for(matrix=d3.csv.parseRows(b),i=0;i<matrix.length;i++)for(j=0;j<matrix[i].length;j++)matrix[i][j]=Number(matrix[i][j])/50;visualize()})});var visualize=function(){function a(a){var b=(a.endAngle-a.startAngle)/a.value;return d3.range(0,a.value,1e3).map(function(c){return{angle:c*b+a.startAngle,label:labels[a.index]}})}function b(a){return function(b,c){k.selectAll(".chord path").filter(function(a){return a.source.index!=c&&a.target.index!=c}).style("opacity",a)}}for(j=0;50>j;j++)for(i=0;i<labels.length;i++)$("#authors").html($("#authors").html()+" "+labels[i]);var c=d3.layout.chord().padding(.06).matrix(matrix);console.log(c);var d=960,e=750,f=.4*Math.min(d,e),g=1.031*f,h=d3.scale.ordinal().domain(d3.range(1)).range(["#2758BB"]),k=d3.select("#vis").append("svg").attr("width",d).attr("height",e).append("g").attr("transform","translate("+d/2+","+e/2+")");k.append("g").selectAll("path").data(c.groups).enter().append("path").style("fill",function(a){return h(a.index)}).style("stroke",function(a){return h(a.index)}).attr("d",d3.svg.arc().innerRadius(f).outerRadius(g)).on("mouseover",b(0)).on("mouseout",b(1));var l=k.append("g").selectAll("g").data(c.groups).enter().append("g").selectAll("g").data(a).enter().append("g").attr("transform",function(a){return"rotate("+(180*a.angle/Math.PI-90)+")translate("+g+",0)"});l.append("text").attr("x",8).attr("dy",".35em").attr("transform",function(a){return a.angle>Math.PI?"rotate(180)translate(-16)":null}).style("text-anchor",function(a){return a.angle>Math.PI?"end":null}).text(function(a){return a.label}),k.append("g").attr("class","chord").selectAll("path").data(c.chords).enter().append("path").attr("d",d3.svg.chord().radius(f)).style("fill",function(a){return h(a.target.index)}).style("opacity",1);k.append("g").selectAll("g").data(c.groups).enter().append("svg:text").attr("x",6).attr("dy",15).append("svg:textPath").text(function(a){return a.label});t1=3e3,dt=3e3,setTimeout(function(){$("#title").css({opacity:1})},0),setTimeout(function(){$("#t1").css({opacity:0}),$("#t2").css({opacity:1})},t1),setTimeout(function(){$("#t2").css({opacity:0}),$("#t3").css({opacity:1}),$("#authors").css({opacity:.4})},t1+dt),setTimeout(function(){$("#t3").css({opacity:0}),$("#t4").css({opacity:1})},t1+2*dt),setTimeout(function(){$("#t4").css({opacity:0}),$("#t5").css({opacity:1})},t1+3*dt),setTimeout(function(){$("#title").css({opacity:0}),$("#vis").css({opacity:1})},t1+3*dt),$(".center").css({"margin-top":"-"+$(".center").height()/2})};